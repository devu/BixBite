var uAgent=navigator.userAgent,prefix;prefix=0<=uAgent.indexOf("Trident")?"-ms-":0<=uAgent.indexOf("MSIE")?"-ms-":0<=uAgent.indexOf("Firefox")?"-moz-":0<=uAgent.indexOf("AppleWebKit")?"-webkit-":0<=uAgent.indexOf("Opera")?"-o-":"";var trace=function(){console.log(Array.prototype.join.call(arguments," "))},getTimer=function(){return Date.now()||new Date},Class=function(){},p=Class.prototype; Function.prototype.extend=function(a){Class.prototype=a.prototype;this.prototype=new Class(a);this.prototype.constructor=this;return this.prototype};function Compound(){}p=Compound.prototype;p.register=function(a,b){this.e.reg(a,b)};p.unregister=function(a){this.e.unt(a)};p.addBehaviour=function(a,b,c,e){this[a]=new b;this[a].initialise(this.e,a,c,this);e&&this[a].execute(this.s)};p.removeBehaviour=function(a){this[a].dispose();this[a]=null;delete this[a]}; p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chT,a,this.s)};p.emitSignal=function(a,b,c){this.s.params=b;!c?this.e.brc(this.chC,a,this.s,this):this.e.brcm("C",a,this.s,this)};function Data(){}p=Data.prototype;p.addSlot=function(a,b){this.e.asl(this.chD,this.uid,a,b,this)};p.removeSlot=function(a){this.e.rsl(this.chD,this.uid,a)};p.responseTo=function(a,b,c){this.e.snd(this.chC,a,b,c?c:this)};p.responseToAll=function(a,b){this.e.brc(this.chC,a,b?b:this)};function Transponder(){}p=Transponder.prototype; p.addSlot=function(a,b){this.e.asl(this.chT,this.uid,a,b,this)};p.removeSlot=function(a){this.e.rsl(this.chT,this.uid,a)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chC,a,this.s)};p.transmit=function(a){this.e.asl(this.chT,this.uid,a,function(b){this.e.brc(this.chC,a,b)})};p.responseToAll=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.responseTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)};p.getSlots=function(a){return this.chC[a]}; p.addSensor=function(a,b){var c=this;document.body["on"+a]=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return b.apply(c,arguments)}};p.removeSensor=function(a){document.body["on"+a]=null};p.getContextUnderPoint=function(a,b,c,e){a=document.elementFromPoint(a,b);if(void 0==c)return a;for(;a&&a.parentNode!=e;){if(a.id==c)return a;a=a.parentNode}return a&&a.id==c?a:null}; p.getContext=function(a,b,c){a=document.getElementById(a);if(void 0==b)return a;var e=a.style,l=parseFloat(e.left)||e.x||0,j=parseFloat(e.top)||e.y||0,f=parseFloat(e.width),e=parseFloat(e.height);return b>l&&b<l+f&&c>j&&c<j+e?a:null};function View(){}p=View.prototype;p.addSlot=function(a,b){this.e.asl(this.chV,this.uid,a,b,this)};p.removeSlot=function(a){this.rsl(this.chV,this.uid,a)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chT,a,this.s)}; p.emitSignal=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.emitSignalTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)};p.getSlots=function(a){return this.chT[a]};p.registerContext=function(a,b){return this.e.bb.regCtx(this,a,b)};p.unregisterContext=function(a){this.e.bb.unrCtx(a)};p.addContext=function(a,b){this.e.bb.addCtx(a,b)};p.onContextAdded=function(){};p.removeContext=function(a){this.e.bb.remCtx(a)};p.onContextRemoved=function(){};function Behaviour(){} p=Behaviour.prototype;p.initialise=function(a,b,c,e){this.e=a;this.uid=a.uid();this.s=this.e.add(this.uid);this.t=b;this.chC=a.chC;this.chD=a.chD;this.chT=a.chT;this.chV=a.chV;this.aDis=c;this.c=e;this.e.asl(this.chC,this.uid,b,this.execute,this);this.init()};p.register=function(a,b){this.e.reg(a,b)};p.unregister=function(a){this.e.unr(a)};p.addResponder=function(a,b,c){this.e.asl(this.chC,this.uid,a,b,this);c&&this.sendRequest(a)};p.removeResponder=function(a){this.e.ras(this.chC,a)}; p.sendRequest=function(a,b){this.s.params=b;this.e.brc(this.chD,a,this.s)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.sendSignalTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)};p.emitSignal=function(a,b,c){this.s.params=b;!c?this.e.brc(this.chC,a,this.s,this):this.e.brcm("C",a,this.s,this)};p.getSlots=function(a){return this.chV[a]}; function BixBite(){function a(a){this.callerUID=a}function b(a,h){this.uid=a;this.send=h}function c(){var a,h,k=-1;this.asl=function(m,g){var c=new b(m,g);c.i=++k;a?a.n=c:h=c;a=c};this.rsl=function(b){for(var g=h,c;g.n&&g.uid!=b;)c=g,g=g.n;c&&g.n&&(c.n=g.n);g.dispose();k--;0>k&&(a=h=null)};this.brc=function(a){for(var b=h;b.n;)b.send.call(b.send._c,a),b=b.n;b.send.call(b.send._c,a)};this.gsl=function(a){for(var b=h;b.n;){if(b.uid==a)return b;b=b.n}return b.uid==a?b:null};this.ras=function(){for(var b= h,c;b.n;)c=b.n,BixBite.dispose(b),k--,b=c;BixBite.dispose(h);BixBite.dispose(a);h=a=null;k--};this.num=function(){return k+1}}function e(){var b=-1;this.chC={};this.chD={};this.chT={};this.chV={};this.add=function(b){return new a(b)};this.reg=function(b,c){if(c&&null!=this[b.uid])this[b.uid].copies++;else{var d=this.uid();this[d]=new b;this[d].uid=d;this[d].s=new a(d);this[d].e=this;this[d].chC=this.chC;this[d].chD=this.chD;this[d].chT=this.chT;this[d].chV=this.chV;this[d].init()}};this.unr=function(a){this[a]&& (0<this[a].cps?this[a].cps--:(this[a].destroy(),this[a]=null,delete this[a]))};this.asl=function(a,b,d,g,e){a[d]||(a[d]=new c);g._c=e;a[d].asl(b,g)};this.rsl=function(a,b,d){var c=a[d];c&&c.gsl(b)&&(c.rsl(b),0==c.num()&&delete a[d])};this.brcm=function(a,b,d){this.chE(a,b,d)};this.brc=function(a,b,d){a[b]&&a[b].brc(d)};this.snd=function(a,b,d,c){a[d]&&(a=a[d].gsl(b))&&a.send.call(a.send._c,c)};this.ras=function(a,b){a[b]&&(a[b].ras(),BixBite.dispose(a[b]))};this.uid=function(){return"@"+ ++b+"::"+ this.cid}}function l(b){var c=this.e=new e;c.cid=b;var k=c.chC;b=c.uid()+b;var f=new a(b);brc=function(a,b,d){c.brc(c["ch"+a],b,d)};this.register=function(a){c.reg(a,!0)};this.unregister=function(a){c.unr(a)};this.emitSignal=function(a,b){f.params=b;c.brc(k,a,f)}}var j={},f={};this.getCtn=function(a){return f[a]};this.spawnCore=function(a){var b=new l(a);b.e.chE=function(a,b,c){for(var d in j)d.brc(a,b,c)};b.e.bb=this;return j[a]=b};this.destroyCore=function(a){j[a]&&(this.dispose(j[a]),delete j[a])}; this.addContextRoot=function(a,b){f[a]=b};this.regCtx=function(a,b,c){f[b]&&alert("Context "+b+"is already registered");c.setAttribute("id",b);c.parentView=a;return f[b]=c};this.unrCtx=function(a){f[a]||alert("There is no such context: "+a+"registered within display list");this.remCtx(a);this.dispose(f[a]);delete f[a]};this.addCtx=function(a,b){var c=f[a];c||alert("There is no context "+a+" registered yet");f[b]||alert("Container "+b+" cannot be found");f[b].appendChild(c);c.parentView.onContextAdded()}; this.remCtx=function(a){if((a=f[a])&&a.parentNode)a.parentNode.removeChild(a),a.parentView.onContextRemoved()}}BixBite.prototype.dispose=function(a){for(var b in a)a.hasOwnProperty("destroy")&&a.destroy(),a.hasOwnProperty(b)&&delete a[b]};