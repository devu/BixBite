var bixbite={version:"0.9.3",prefix:""},uAgent=navigator.userAgent;0<=uAgent.indexOf("Trident")?bixbite.prefix="-ms-":0<=uAgent.indexOf("MSIE")?bixbite.prefix="-ms-":0<=uAgent.indexOf("Firefox")?bixbite.prefix="-moz-":0<=uAgent.indexOf("AppleWebKit")?bixbite.prefix="-webkit-":0<=uAgent.indexOf("Opera")&&(bixbite.prefix="-o-"); var trace=function(){"undefined"!=typeof console&&console.log(Array.prototype.join.call(arguments," "))},getTimer=function(){return Date.now()||new Date},uintToHex=function(a){a=a.toString(16);return"#000000".slice(0,-a.length)+a},parseVal=function(a){if(isNaN(a))return a;var b=a.toString();return 0<=b.indexOf("%")?b:a+"px"},Class=function(a){},p=Class.prototype;Function.prototype.extend=function(a){Class.prototype=a.prototype;this.prototype=new Class(a);this.prototype.constructor=this;return this.prototype}; var styleList=document.styleSheets;if(0==styleList.length){var s=document.createElement("style");s.type="text/css";document.getElementsByTagName("head")[0].appendChild(s)}var addStyleRule=function(a,b){styleList[0].insertRule(a+"{"+b+"}",0)};addStyleRule("html, body","height:100%; overflow:hidden;");addStyleRule("body","margin:0;");addStyleRule("div","display:block; position:absolute;");addStyleRule(".stage","display:block; position:absolute; background:#ffffff; "+bixbite.prefix+"transform:translateZ(0);"); addStyleRule(".shape","display:block; position:absolute;");addStyleRule(".sprite","display:block; position:absolute;");addStyleRule(".textfield","display:block; position:absolute; overflow:hidden; white-space:nowrap; border-color:#000000; padding:1px; text-overflow:clip");addStyleRule(".gfx","display:block; position:absolute;");addStyleRule(".bitmapdata","display:block; position:relative;");addStyleRule(".bitmap","display:block; position:absolute; overflow:hidden;"); MouseEvent={CLICK:"click",DOUBLE_CLICK:"dblclick",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_OVER:"mouseover",MOUSE_UP:"mouseup"};TouchEvent={TAP:"click",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend"};function Graphics(a){this.dsp=a;this.ctx=a.ctx}p=Graphics.prototype;p.beginFill=function(a,b){this.c=uintToHex(a);this.a=b};p.setStyle=function(a){addStyleRule("."+a,this.gfx.style.cssText)}; p.applyStyle=function(a){var b=document.createElement("div");b.className=a;this.ctx.appendChild(b)};p.clear=function(){for(;this.ctx.firstChild;)this.ctx.removeChild(this.ctx.firstChild)};p.drawRect=function(a,b,c,d){var g=(this.gfx=document.createElement("div")).style;g.backgroundColor=this.c;g.opacity=this.a?this.a:1;g.left=parseVal(a);g.top=parseVal(b);g.width=parseVal(c);g.height=parseVal(d);this.ctx.appendChild(this.gfx);this.dsp.update(c,d)}; p.drawCircle=function(a,b,c){var d=(this.gfx=document.createElement("div")).style;d.backgroundColor=this.c;d.opacity=this.a?this.a:1;d.left=parseVal(a-c);d.top=parseVal(b-c);d.width=parseVal(2*c);d.height=parseVal(2*c);d.borderRadius=parseVal(c);this.ctx.appendChild(this.gfx)};function EventDispatcher(){}p=EventDispatcher.prototype;function DisplayObject(){this._r=0;this._sy=this._sx=1;this._y=this._x=0}p=DisplayObject.extend(EventDispatcher);p._w=0;p._h=0; p.update=function(a,b){this._w<a&&(this._w=a);this._h<b&&(this._h=b)};p.setCtx=function(a,b){this.ctx=document.createElement(a);this.ctx.className=b;this.style=this.ctx.style;EventDispatcher.call(this)};p.transform=function(){this.stage&&this.style.setProperty(prefix+"transform","rotate("+this._r+"deg) scale("+this._sx+", "+this._sy+")")};Object.defineProperty(p,"name",{get:function(){return this.ctx.getAttribute("id")},set:function(a){this.ctx.setAttribute("id",a)}}); Object.defineProperty(p,"x",{get:function(){return this._x},set:function(a){this._x=a;this.style.left=a+"px"}});Object.defineProperty(p,"y",{get:function(){return this._y},set:function(a){this._y=a;this.style.top=a+"px"}});Object.defineProperty(p,"width",{get:function(){return this._sx*this._w},set:function(a){this._sx=a/this._w;this.transform()}});Object.defineProperty(p,"height",{get:function(){return this._sy*this._h},set:function(a){this._sy=a/this._h;this.transform()}}); Object.defineProperty(p,"rotation",{get:function(){return this._r},set:function(a){this._r=a;this.transform()}});Object.defineProperty(p,"scaleX",{get:function(){return this._sx},set:function(a){this._sx*=a;this.transform()}});Object.defineProperty(p,"scaleY",{get:function(){return this._sy},set:function(a){this._sy*=a;this.transform()}}); Object.defineProperty(p,"visible",{get:function(){return this._visible},set:function(a){this._visible=a;this.parent&&(a?(this.parent.addChild(this),this.parent=null):this.parent.removeChild(this))}});p.visible=!0;function InteractiveObject(){this.mouseChildren=!0;DisplayObject.call(this)}p=InteractiveObject.extend(DisplayObject);p.addEventListener=function(a,b){var c=this;this.ctx.addEventListener(a,function(){return b.apply(c,arguments)},!1)}; p.removeEventListener=function(a){this.ctx.removeEventListener(a,cb)};Object.defineProperty(p,"mouseChildren",{get:function(){return this._mchildren},set:function(a){this._mchildren=a}});function DisplayObjectContainer(){this.children=[];InteractiveObject.call(this)}p=DisplayObjectContainer.extend(InteractiveObject);p.addChildAt=function(a,b){a.parent=this;a.transform();this.children.splice(b,0,a);a._visible&&this.ctx.appendChild(a.ctx)};p.addChild=function(a){return this.addChildAt(a,this.children.length)}; p.removeChildAt=function(a){if(!(a>=this.children.length)){var b=this.children[a];this.children.splice(a,1);b.parent=null;b.stage=null;b._visible&&this.ctx.removeChild(b.ctx)}};p.removeChild=function(a){removeChildAt(this.children.indexOf(a))};p.getChildAt=function(a){return this.children[a]};p.getChildIndex=function(a){return children.indexOf(a)};p.removeAllChildren=function(){for(;0<this.children.length;)this.removeChildAt(0)}; p.getObjectsUnderPoint=function(a){a=[];for(var b in this.children)a.push(this.children[b]);return a};function Shape(){DisplayObject.call(this);this.setCtx("div","shape");this.graphics.ctx=this.ctx}p=Shape.extend(DisplayObject);p.graphics=new Graphics(p);function BitmapData(a,b,c){this.ctx=document.createElement("div");this.ctx.className="bitmapData";this.url="url("+a+")";this.width=b;this.height=c}p=BitmapData.prototype; Object.defineProperty(p,"url",{get:function(){return this._url},set:function(a){this._url=a;this.ctx.style.backgroundImage=a}});Object.defineProperty(p,"width",{get:function(){return this._w},set:function(a){this._w=a;this.ctx.style.width=parseVal(a)}});Object.defineProperty(p,"height",{get:function(){return this._h},set:function(a){this._h=a;this.ctx.style.height=parseVal(a)}});function Bitmap(a){DisplayObject.call(this);this.setCtx("div","bitmap");this.bitmapData=a}p=Bitmap.extend(DisplayObject); Object.defineProperty(p,"bitmapData",{get:function(){return this._bmpData},set:function(a){this._bmpData=a;this.ctx.appendChild(a.ctx)}});function Sprite(){DisplayObjectContainer.call(this);this.setCtx("div","sprite");this.graphics.ctx=this.ctx}p=Sprite.extend(DisplayObjectContainer);p.graphics=new Graphics(p);function TextField(){InteractiveObject.call(this);this.setCtx("div","textfield");this._border=!1;this._brColor=1048575;this._bg=!1;this._bgColor=0;this._multiline=!1}p=TextField.extend(InteractiveObject); Object.defineProperty(p,"text",{get:function(){return this.ctx.innerHTML},set:function(a){this.ctx.innerHTML=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}});Object.defineProperty(p,"htmlText",{get:function(){return this.ctx.innerHTML},set:function(a){this.ctx.innerHTML=a}});Object.defineProperty(p,"textColor",{get:function(){return this.style.color},set:function(a){this.style.color=uintToHex(a)}}); Object.defineProperty(p,"defaultTextFormat",{get:function(){return this._format},set:function(a){this.ctx.innerHTML=""}});Object.defineProperty(p,"border",{get:function(){return this._border},set:function(a){this._border=a;this.style.border=a?"1px solid":null}});Object.defineProperty(p,"borderColor",{get:function(){return this._brColor},set:function(a){this._brColor=a;this.style.borderColor=uintToHex(a)}}); Object.defineProperty(p,"background",{get:function(){return this._bg},set:function(a){this._bg=a;this.style.background=a?uintToHex(this.backgroundColor):null}});Object.defineProperty(p,"backgroundColor",{get:function(){return this._bgColor},set:function(a){this._bgColor=a;this._bg&&(this.style.background=uintToHex(a))}});Object.defineProperty(p,"width",{get:function(){return this._w},set:function(a){this._w=a;this.style.width=parseVal(a)}}); Object.defineProperty(p,"height",{get:function(){return this._h},set:function(a){this._h=a;this.style.height=parseVal(a)}});Object.defineProperty(p,"multiline",{get:function(){return this._multiline},set:function(a){this._multiline=a;this.style.whiteSpace=a?"pre":"nowrap"}});Object.defineProperty(p,"wordWrap",{get:function(){return this._wwrap},set:function(a){this._wwrap=a;this.style.whiteSpace=this._multiline?"normal":this._multiline}}); function Stage(a){DisplayObjectContainer.call(this);this.setCtx("div","stage");document.body.appendChild(this.ctx)}p=Stage.extend(DisplayObjectContainer);p.setMeta=function(a,b,c,d,g){this.style.backgroundColor=uintToHex(c);this.style.width=parseVal(a);this.style.height=parseVal(b)};function Compound(){}p=Compound.prototype;p.register=function(a,b){this.e.reg(a,b)};p.unregister=function(a){this.e.unt(a)};p.addBehaviour=function(a,b,c,d){this[a]=new b;this[a].initialise(this.e,a,c,this);d&&this[a].execute(this.s)}; p.removeBehaviour=function(a){this[a].dispose();this[a]=null;delete this[a]};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chT,a,this.s)};p.emitSignal=function(a,b,c){this.s.params=b;c?this.e.brcm("C",a,this.s,this):this.e.brc(this.chC,a,this.s,this)};p.destroy=function(){};function Data(){}p=Data.prototype;p.addSlot=function(a,b){this.e.asl(this.chD,this.uid,a,b,this)};p.removeSlot=function(a){this.e.rsl(this.chD,this.uid,a)}; p.responseTo=function(a,b,c){this.e.snd(this.chC,a,b,c?c:this)};p.responseToAll=function(a,b){this.e.brc(this.chC,a,b?b:this)};p.destroy=function(){this.e.ras(this.chD,this.uid)};function Transponder(){}p=Transponder.prototype;p.addSlot=function(a,b){this.e.asl(this.chT,this.uid,a,b,this)};p.removeSlot=function(a){this.e.rsl(this.chT,this.uid,a)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chC,a,this.s)}; p.transmit=function(a){this.e.asl(this.chT,this.uid,a,function(b){this.e.brc(this.chC,a,b)})};p.responseToAll=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.responseTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)};p.getSlots=function(a){return this.chC[a]};p.addSensor=function(a,b){var c=this;document.body["on"+a]=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;return b.apply(c,arguments)}};p.removeSensor=function(a,b){document.body["on"+a]=null}; p.getContainer=function(a){return this.e.bb.getCtn(a)};function View(){}p=View.prototype;p.addSlot=function(a,b){this.e.asl(this.chV,this.uid,a,b,this)};p.removeSlot=function(a){this.rsl(this.chV,this.uid,a)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chT,a,this.s)};p.emitSignal=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.emitSignalTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)};p.getSlots=function(a){return this.chT[a]}; p.registerContext=function(a,b){return this.e.bb.regCtx(this,a,b)};p.unregisterContext=function(a){this.e.bb.unrCtx(a)};p.getContainer=function(a){return this.e.bb.getCtn(a)};function Behaviour(){}p=Behaviour.prototype;p.initialise=function(a,b,c,d){this.e=a;this.uid=a.uid();this.s=this.e.add(this.uid);this.t=b;this.chC=a.chC;this.chD=a.chD;this.chT=a.chT;this.chV=a.chV;this.aDis=c;this.c=d;this.e.asl(this.chC,this.uid,b,this.execute,this);this.init()};p.register=function(a,b){this.e.reg(a,b)}; p.unregister=function(a){this.e.unr(a)};p.addResponder=function(a,b,c){this.e.asl(this.chC,this.uid,a,b,this);c&&this.sendRequest(a)};p.removeResponder=function(a){this.e.ras(this.chC,a)};p.sendRequest=function(a,b){this.s.params=b;this.e.brc(this.chD,a,this.s)};p.sendSignal=function(a,b){this.s.params=b;this.e.brc(this.chV,a,this.s)};p.sendSignalTo=function(a,b,c){this.s.params=c;this.e.snd(this.chV,a,b,this.s)}; p.emitSignal=function(a,b,c){this.s.params=b;c?this.e.brcm("C",a,this.s,this):this.e.brc(this.chC,a,this.s,this)};p.getSlots=function(a){return this.chV[a]};function Context(){this._view=null;Sprite.call(this)}p=Context.extend(Sprite);p.init=function(){};p.dispose=function(){};Object.defineProperty(p,"view",{get:function(){return this._view},set:function(a){this._view=a}});function ContextContainer(){Context.call(this)}p=ContextContainer.extend(Context); function BixBite(){function a(a){this.callerUID=a}function b(a,b){this.uid=a;this.send=b}function c(){var a,h,c=-1;this.asl=function(f,e){var d=new b(f,e);d.i=++c;a?a.n=d:h=d;a=d};this.rsl=function(b){for(var e=h,d;e.n&&e.uid!=b;)d=e,e=e.n;d&&e.n&&(d.n=e.n);e.dispose();c--;0>c&&(a=h=null)};this.brc=function(a){for(var b=h;b.n;)b.send.call(b.send._c,a),b=b.n;b.send.call(b.send._c,a)};this.gsl=function(a){for(var b=h;b.n;){if(b.uid==a)return b;b=b.n}return b.uid==a?b:null};this.ras=function(){for(var b= h,e;b.n;)e=b.n,BixBite.dispose(b),c--,b=e;BixBite.dispose(h);BixBite.dispose(a);h=a=null;c--};this.num=function(){return c+1}}function d(){var b=-1;this.chC={};this.chD={};this.chT={};this.chV={};this.add=function(b){return new a(b)};this.reg=function(b,c){if(c&&null!=this[b.uid])this[b.uid].copies++;else{var f=this.uid();this[f]=new b;this[f].uid=f;this[f].s=new a(f);this[f].e=this;this[f].chC=this.chC;this[f].chD=this.chD;this[f].chT=this.chT;this[f].chV=this.chV;this[f].init()}};this.unr=function(a){this[a]&& (0<this[a].cps?this[a].cps--:(this[a].destroy(),this[a]=null,delete this[a]))};this.asl=function(a,b,f,e,d){a[f]||(a[f]=new c);e._c=d;a[f].asl(b,e)};this.rsl=function(a,b,c){var e=a[c];e&&e.gsl(b)&&(e.rsl(b),0==e.num()&&delete a[c])};this.brcm=function(a,b,c){this.chE(a,b,c)};this.brc=function(a,b,c){a[b]&&a[b].brc(c)};this.snd=function(a,b,c,e){a[c]&&(a=a[c].gsl(b))&&a.send.call(a.send._c,e)};this.ras=function(a,b){a[b]&&(a[b].ras(),BixBite.dispose(a[b]))};this.uid=function(){return"@"+ ++b+"::"+ this.cid}}function g(b){var c=this.e=new d;c.cid=b;var g=c.chC;b=c.uid()+b;var f=new a(b);brc=function(a,b,d){c.brc(c["ch"+a],b,d)};this.register=function(a){c.reg(a,!0)};this.unregister=function(a){c.unr(a)};this.emitSignal=function(a,b){f.params=b;c.brc(g,a,f)}}var l={},k={},m=new Stage;this.getCtn=function(a){return k[a]};this.addCtn=function(a,b){b.id=a;m.addChild(b);k[a]=b;b.init()};this.spawnCore=function(a){var b=new g(a);b.e.chE=function(a,b,c){for(var d in l)d.brc(a,b,c)};b.e.bb=this;return l[a]= b};this.destroyCore=function(a){l[a]&&(this.dispose(l[a]),delete l[a])};this.regCtx=function(a,b,c){k[b]&&alert("Context "+b+"is already registered");c.id=b;c.view=a;return k[b]=c};this.unrCtx=function(a){k[a]||alert("There is no such context: "+a+"registered within display list");var b=k[a];b&&b.parentNode&&(b.parentNode.removeChild(b),ctn.view=null,ctn.dispose());this.dispose(k[a]);delete k[a]};this.addCtn("root",new ContextContainer)} BixBite.prototype.dispose=function(a){a.hasOwnProperty("destroy")&&a.destroy();for(var b in a)a.hasOwnProperty(b)&&delete a[b]};